# KnockOff v10.19.0

**Release Date:** 2026-01-15
**Breaking Changes:** No

---

## Summary

Bug fix for BCL collection stubs and internal generator refactoring to Model+Renderer pattern.

---

## What's New

### Bug Fix: BCL Collection GetEnumerator Delegation

When stubbing `IEnumerable<T>` (which inherits from `IEnumerable`), the non-generic `GetEnumerator()` method now correctly delegates to the generic `GetEnumerator()` method.

**Before:** Each method had its own interceptor, causing confusion when configuring callbacks:

```csharp
var stub = new Stubs.IEnumerable<string>();
stub.GetEnumerator.OnCall = ko => items.GetEnumerator();

// Non-generic call would fail - had separate unconfigured interceptor
IEnumerable nonGeneric = stub;
nonGeneric.GetEnumerator(); // Would throw or return default
```

**After:** Non-generic delegates to generic, single interceptor handles both:

```csharp
var stub = new Stubs.IEnumerable<string>();
stub.GetEnumerator.OnCall = ko => items.GetEnumerator();

// Now works - delegates to generic version
IEnumerable nonGeneric = stub;
nonGeneric.GetEnumerator(); // Returns configured enumerator
```

This affects all BCL collection interfaces: `IEnumerable<T>`, `ICollection<T>`, `IList<T>`, `ISet<T>`, `IDictionary<TKey, TValue>`, etc.

---

## Internal Changes

### Generator Refactored to Model+Renderer Pattern

The source generator has been refactored from a monolithic design to a clean separation of concerns:

- **Model Builders** (`FlatModelBuilder`, `InlineModelBuilder`, `ClassModelBuilder`) - Transform `KnockOffTypeInfo` into domain-specific generation models
- **Renderers** (`FlatRenderer`, `InlineRenderer`, `ClassRenderer`) - Emit source code from models using `CodeWriter`
- **CodeWriter** - Utility for generating formatted C# with automatic indentation

This refactoring:
- Removed ~2,600 lines of dead code
- Improves maintainability and testability
- Does not change generated output (all existing tests pass)

---

## Migration Guide

No migration required. This is a drop-in replacement for v10.18.0.
