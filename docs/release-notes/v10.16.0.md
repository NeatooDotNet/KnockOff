# v10.16.0 - Strict Mode

**Release Date:** 2026-01-13

## Summary

This release adds **strict mode** support, matching Moq's `MockBehavior.Strict` behavior. When enabled, unconfigured method calls throw `StubException` instead of returning default values.

## New Feature: Strict Mode

By default, KnockOff stubs return smart defaults for unconfigured methods. Strict mode throws `StubException` instead, catching unexpected interactions during tests.

### Standalone Stubs

Set the `Strict` property:

```csharp
var stub = new UserServiceKnockOff();
stub.Strict = true;

IUserService service = stub.Object;
service.GetUser(1);  // Throws StubException - no OnCall configured!
```

### Inline Stubs

Use the constructor parameter:

```csharp
var stub = new Stubs.IUserService(strict: true);
stub.GetUser.OnCall = (ko, id) => new User { Id = id };

IUserService service = stub.Object;
service.GetUser(1);     // OK - OnCall configured
service.DeleteUser(1);  // Throws StubException!
```

### Attribute Defaults

Set project-wide defaults via the attribute:

```csharp
// Standalone - all instances default to strict
[KnockOff(Strict = true)]
public partial class StrictUserServiceKnockOff : IUserService { }

// Inline - generated constructor defaults to strict
[KnockOff<IUserService>(Strict = true)]
public partial class MyTests { }
```

Override per-instance when needed:

```csharp
// Standalone
var stub = new StrictUserServiceKnockOff();
stub.Strict = false;  // This instance is lenient

// Inline
var stub = new Stubs.IUserService(strict: false);
```

## What Throws in Strict Mode

| Member Type | Throws When |
|-------------|-------------|
| Methods | No `OnCall` callback configured |
| Properties (get) | No `OnGet` callback configured |
| Properties (set) | No `OnSet` callback configured |
| Indexers | No `OnGet`/`OnSet` configured |
| Void methods | No `OnCall` callback configured |

**Note:** Init-only properties don't throw in strict mode (they're set via object initializers).

## Moq Migration

Moq's `MockBehavior.Strict` maps directly:

```csharp
// Moq
var mock = new Mock<IUserService>(MockBehavior.Strict);
mock.Setup(x => x.GetUser(1)).Returns(new User());

// KnockOff - standalone
var stub = new UserServiceKnockOff();
stub.Strict = true;
stub.GetUser.OnCall = (ko, id) => new User();

// KnockOff - inline
var stub = new Stubs.IUserService(strict: true);
stub.GetUser.OnCall = (ko, id) => new User();
```

## New Types

- `KnockOff.StubException` - Exception thrown for unconfigured calls in strict mode
- `StubException.NotConfigured(interfaceName, memberName)` - Factory method with clear error message

## Upgrade Notes

No breaking changes. Default behavior remains lenient (returns smart defaults). Strict mode is opt-in via:
- `stub.Strict = true` (standalone)
- Constructor parameter `strict: true` (inline)
- Attribute `[KnockOff(Strict = true)]` (default for type)
